<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/main}">
<head>
    <title>Danh sách Khách sạn - Quản Lý Khách Sạn</title>
</head>
<body>
    <main layout:fragment="content">
        <div class="container py-4">
            <h2 class="text-center mb-4">Các Khách sạn tìm thấy</h2>
            
            <div class="row">
                <!-- Bộ lọc -->
                <div class="col-md-3">
                    <div class="card" style="background: rgba(248, 250, 252, 0.9); border: 1px solid #e2e8f0;">
                        <div class="card-header">
                            <h5 class="mb-0"><i class="fas fa-filter me-2"></i>Chọn lọc theo</h5>
                        </div>
                        <div class="card-body">
                            <form id="filterForm">
                                <!-- Xếp hạng -->
                                <div class="mb-4">
                                    <h6 class="fw-bold">Xếp hạng</h6>
                                    <div class="form-check" th:each="i : ${#numbers.sequence(0, 5)}">
                                        <input class="form-check-input filter-checkbox" type="checkbox" 
                                               th:id="'rating-' + ${i}" th:value="${i}" name="danhGia">
                                        <label class="form-check-label" th:for="'rating-' + ${i}">
                                            <span th:if="${i == 0}">Không xếp hạng</span>
                                            <span th:if="${i > 0}" th:text="${i} + ' Sao'">1 Sao</span>
                                        </label>
                                    </div>
                                </div>
                                
                                <!-- Loại khách sạn -->
                                <div class="mb-4" th:if="${typeHotelList != null}">
                                    <h6 class="fw-bold">Loại khách sạn</h6>
                                    <div class="form-check" th:each="item : ${typeHotelList}">
                                        <input class="form-check-input filter-checkbox" type="checkbox" 
                                               th:id="'type-' + ${item.id}" th:value="${item.name}" name="loaiKhachSan">
                                        <label class="form-check-label" th:for="'type-' + ${item.id}" th:text="${item.name}">
                                            Loại khách sạn
                                        </label>
                                    </div>
                                </div>
                                
                                <!-- Giáp biển -->
                                <div class="mb-4">
                                    <h6 class="fw-bold">Giáp biển</h6>
                                    <div class="form-check">
                                        <input class="form-check-input filter-checkbox" type="checkbox" id="beach-false" value="false" name="giapBien">
                                        <label class="form-check-label" for="beach-false">Không giáp</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input filter-checkbox" type="checkbox" id="beach-true" value="true" name="giapBien">
                                        <label class="form-check-label" for="beach-true">Có giáp</label>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                
                <!-- Danh sách khách sạn -->
                <div class="col-md-9">
                    <div id="hotelList">
                        <div class="row" th:if="${hotelList != null and !hotelList.empty}">
                            <div class="col-12 mb-4" th:each="hotel : ${hotelList}">
                                <a th:href="@{/hotel/{id}(id=${hotel.id})}" class="text-decoration-none">
                                    <div class="card card-hover">
                                        <div class="row g-0">
                                            <div class="col-md-4">
                                                <img th:src="@{'/images/KhachSan/' + ${hotel.id} + '.jpg'}" 
                                                     class="img-fluid rounded-start h-100" alt="Khách sạn" style="object-fit: cover;">
                                            </div>
                                            <div class="col-md-8">
                                                <div class="card-body">
                                                    <div class="d-flex justify-content-between align-items-start">
                                                        <div>
                                                            <h5 class="card-title text-primary" th:text="${hotel.name}">Tên khách sạn</h5>
                                                           <p class="text-muted mb-2">
                                                                <i class="fas fa-map-marker-alt me-1"></i>
                                                                <span class="fw-bold text-success" th:text="${hotel.cityName}">Thành phố</span>
                                                               
                                                            </p>
                                                            <p class="text-muted mb-2" th:text="${hotel.typeHotelName}">Loại khách sạn</p>
                                                            <p class="mb-2">
                                                                Giáp biển: <span th:text="${hotel.nearSea == 0 ? 'Có' : 'Không'}">Không</span>
                                                            </p>
                                                            <p class="card-text text-muted" th:text="${hotel.description}">Mô tả</p>
                                                        </div>
														<div class="text-end">
														                <!-- Sao động -->
														                <div class="rating-stars fs-4">
														                    <span th:each="i : ${#numbers.sequence(1,5)}"
														                          th:text="${i <= hotel.evaluate ? '★' : '☆'}"
														                          class="text-warning"></span>
														                </div>

														                <!-- Text đánh giá -->
														                <small class="text-primary fw-bold"
														                       th:text="${hotel.evaluate == 0 ? 'Bình thường' : 
														                                hotel.evaluate == 1 ? 'Khá ổn' :
														                                hotel.evaluate == 2 ? 'Chất lượng' :
														                                hotel.evaluate == 3 ? 'Sang trọng' :
														                                hotel.evaluate == 4 ? 'Tuyệt vời' : 'Xuất sắc'}">
														                    Xuất sắc
														                </small>
														            </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div>
                        
                        <div class="text-center py-5" th:if="${hotelList == null or hotelList.empty}">
                            <i class="fas fa-search fa-3x text-muted mb-3"></i>
                            <h4 class="text-muted">Không tìm thấy khách sạn nào</h4>
                            <p class="text-muted">Vui lòng thử lại với từ khóa khác</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
	<script>
	document.addEventListener('DOMContentLoaded', function() {
	    const filterCheckboxes = document.querySelectorAll('.filter-checkbox');
	    const hotelListContainer = document.getElementById('hotelList');

	    function applyFilters() {
	        // Thu thập filter đã chọn
	        const params = new URLSearchParams();

	        filterCheckboxes.forEach(cb => {
	            if (cb.checked) {
	                // Nếu có nhiều checkbox cùng name thì server nhận thành mảng
	                params.append(cb.name, cb.value);
	            }
	        });

	        // Gọi API backend (thay đường dẫn bằng API thật)
	        fetch('/khach-san/filter?' + params.toString())
	            .then(response => response.json())
	            .then(data => {
	                // Xóa danh sách cũ
	                hotelListContainer.innerHTML = '';

	                if (data.length === 0) {
	                    hotelListContainer.innerHTML = '<p>Không tìm thấy khách sạn nào.</p>';
	                    return;
	                }

	                // Render danh sách mới
	                data.forEach(hotel => {
	                    const hotelHtml = `
	                        <div class="col-12 mb-4">
	                            <a href="/khach-san/${hotel.id}" class="text-decoration-none">
	                                <div class="card card-hover">
	                                    <div class="row g-0">
	                                        <div class="col-md-4">
	                                            <img src="/images/KhachSan/${hotel.id}.jpg"
	                                                 class="img-fluid rounded-start h-100" 
	                                                 alt="Khách sạn" style="object-fit: cover;">
	                                        </div>
	                                        <div class="col-md-8">
	                                            <div class="card-body">
	                                                <h5 class="card-title text-muted">${hotel.name}</h5>
	                                                <p class="text-muted mb-2">
	                                                    <i class="fas fa-map-marker-alt me-1"></i>
	                                                    <span class="fw-bold text-success">${hotel.cityName}</span>
	                                                </p>
	                                                <p class="text-muted mb-2">${hotel.typeHotelName}</p>
	                                                <p class="mb-2">
	                                                    Giáp biển: <span class="text-primary">${hotel.nearSea == 0 ? 'Có' : 'Không'}</span>
	                                                </p>
	                                                <p class="card-text text-muted">${hotel.description}</p>
	                                            </div>
	                                        </div>
	                                    </div>
	                                </div>
	                            </a>
	                        </div>`;
	                    hotelListContainer.insertAdjacentHTML('beforeend', hotelHtml);
	                });
	            })
	            .catch(error => {
	                console.error('Error loading hotels:', error);
	                hotelListContainer.innerHTML = '<p class="text-danger">Có lỗi xảy ra khi tải dữ liệu.</p>';
	            });
	    }

	    // Gắn event change cho từng checkbox
	    filterCheckboxes.forEach(checkbox => {
	        checkbox.addEventListener('change', applyFilters);
	    });
	});
	</script>

</body>
</html>